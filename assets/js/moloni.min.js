!function(o){"object"==typeof module&&"object"==typeof module.exports?o(require("jquery"),window,document):o(jQuery,window,document)}(function(s,o,t,i){function l(){return n.length?n[n.length-1]:null}function e(){for(var o=!1,t=n.length-1;0<=t;t--)n[t].$blocker&&(n[t].$blocker.toggleClass("current",!o).toggleClass("behind",o),o=!0)}var n=[];s.modal=function(i,o){var e;if(this.$body=s("body"),this.options=s.extend({},s.modal.defaults,o),this.options.doFade=!isNaN(parseInt(this.options.fadeDuration,10)),this.$blocker=null,this.options.closeExisting)for(;s.modal.isActive();)s.modal.close();if(n.push(this),i.is("a"))if(o=i.attr("href"),this.anchor=i,/^#/.test(o)){if(this.$elm=s(o),1!==this.$elm.length)return null;this.$body.append(this.$elm),this.open()}else this.$elm=s("<div>"),this.$body.append(this.$elm),e=function(o,t){t.elm.remove()},this.showSpinner(),i.trigger(s.modal.AJAX_SEND),s.get(o).done(function(o){var t;s.modal.isActive()&&(i.trigger(s.modal.AJAX_SUCCESS),(t=l()).$elm.empty().append(o).on(s.modal.CLOSE,e),t.hideSpinner(),t.open(),i.trigger(s.modal.AJAX_COMPLETE))}).fail(function(){i.trigger(s.modal.AJAX_FAIL),l().hideSpinner(),n.pop(),i.trigger(s.modal.AJAX_COMPLETE)});else this.$elm=i,this.anchor=i,this.$body.append(this.$elm),this.open()},s.modal.prototype={constructor:s.modal,open:function(){var o=this;this.block(),this.anchor.blur(),this.options.doFade?setTimeout(function(){o.show()},this.options.fadeDuration*this.options.fadeDelay):this.show(),s(t).off("keydown.modal").on("keydown.modal",function(o){var t=l();27===o.which&&t.options.escapeClose&&t.close()}),this.options.clickClose&&this.$blocker.click(function(o){o.target===this&&s.modal.close()})},close:function(){n.pop(),this.unblock(),this.hide(),s.modal.isActive()||s(t).off("keydown.modal")},block:function(){this.$elm.trigger(s.modal.BEFORE_BLOCK,[this._ctx()]),this.$body.css("overflow","hidden"),this.$blocker=s('<div class="'+this.options.blockerClass+' blocker current"></div>').appendTo(this.$body),e(),this.options.doFade&&this.$blocker.css("opacity",0).animate({opacity:1},this.options.fadeDuration),this.$elm.trigger(s.modal.BLOCK,[this._ctx()])},unblock:function(o){!o&&this.options.doFade?this.$blocker.fadeOut(this.options.fadeDuration,this.unblock.bind(this,!0)):(this.$blocker.children().appendTo(this.$body),this.$blocker.remove(),this.$blocker=null,e(),s.modal.isActive()||this.$body.css("overflow",""))},show:function(){this.$elm.trigger(s.modal.BEFORE_OPEN,[this._ctx()]),this.options.showClose&&(this.closeButton=s('<a href="#close-modal" rel="modal:close" class="close-modal '+this.options.closeClass+'">'+this.options.closeText+"</a>"),this.$elm.append(this.closeButton)),this.$elm.addClass(this.options.modalClass).appendTo(this.$blocker),this.options.doFade?this.$elm.css({opacity:0,display:"inline-block"}).animate({opacity:1},this.options.fadeDuration):this.$elm.css("display","inline-block"),this.$elm.trigger(s.modal.OPEN,[this._ctx()])},hide:function(){this.$elm.trigger(s.modal.BEFORE_CLOSE,[this._ctx()]),this.closeButton&&this.closeButton.remove();var o=this;this.options.doFade?this.$elm.fadeOut(this.options.fadeDuration,function(){o.$elm.trigger(s.modal.AFTER_CLOSE,[o._ctx()])}):this.$elm.hide(0,function(){o.$elm.trigger(s.modal.AFTER_CLOSE,[o._ctx()])}),this.$elm.trigger(s.modal.CLOSE,[this._ctx()])},showSpinner:function(){this.options.showSpinner&&(this.spinner=this.spinner||s('<div class="'+this.options.modalClass+'-spinner"></div>').append(this.options.spinnerHtml),this.$body.append(this.spinner),this.spinner.show())},hideSpinner:function(){this.spinner&&this.spinner.remove()},_ctx:function(){return{elm:this.$elm,$elm:this.$elm,$blocker:this.$blocker,options:this.options,$anchor:this.anchor}}},s.modal.close=function(o){if(s.modal.isActive())return o&&o.preventDefault(),(o=l()).close(),o.$elm},s.modal.isActive=function(){return 0<n.length},s.modal.getCurrent=l,s.modal.defaults={closeExisting:!0,escapeClose:!0,clickClose:!0,closeText:"Close",closeClass:"",modalClass:"modal",blockerClass:"jquery-modal",spinnerHtml:'<div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div>',showSpinner:!0,showClose:!0,fadeDuration:null,fadeDelay:1},s.modal.BEFORE_BLOCK="modal:before-block",s.modal.BLOCK="modal:block",s.modal.BEFORE_OPEN="modal:before-open",s.modal.OPEN="modal:open",s.modal.BEFORE_CLOSE="modal:before-close",s.modal.CLOSE="modal:close",s.modal.AFTER_CLOSE="modal:after-close",s.modal.AJAX_SEND="modal:ajax:send",s.modal.AJAX_SUCCESS="modal:ajax:success",s.modal.AJAX_FAIL="modal:ajax:fail",s.modal.AJAX_COMPLETE="modal:ajax:complete",s.fn.modal=function(o){return 1===this.length&&new s.modal(this,o),this},s(t).on("click.modal",'a[rel~="modal:close"]',s.modal.close),s(t).on("click.modal",'a[rel~="modal:open"]',function(o){o.preventDefault(),s(this).modal()})});
var Moloni;void 0===(Moloni=void 0===Moloni?{}:Moloni).modals&&(Moloni.modals={}),Moloni.modals.ProductsBulkProcess=async function(l,a,t){const i=jQuery,s={create:[],stock:[],update:[]},r=i("#action-modal");var o=r.find(".button-secondary"),e=r.find("#action-modal-spinner");const p=r.find("#action-modal-content");var d=r.find("#action-modal-error"),n=r.find("#action-modal-title-start"),c=r.find("#action-modal-title-end");p.html("").show(),o.hide(),d.hide(),e.show(),n.show(),c.hide();const u=(o,e)=>{o={action:t,ml_product_id:o,wc_product_id:e};return i.ajax({type:"POST",url:ajaxurl,data:o,async:!0})},h=(o,e)=>{o={action:a,ml_product_id:o,wc_product_id:e};return i.ajax({type:"POST",url:ajaxurl,data:o,async:!0})};const f=async()=>{if(l.length){var o=i(l.shift()),e=o.closest(".product__row"),a=e.data("moloniId"),t=e.data("wcId"),d=e.find(".product__row-name").text().trim(),e=e.find(".product__row-reference").text().trim(),n=null,c=null;if(o.hasClass("checkbox_create_product")?(n=h.bind(this,a,t),c="create"):o.hasClass("checkbox_update_stock_product")&&(n=u.bind(this,a,t),c="stock"),n&&c)return o=d+" ("+e+")",p.html("A processar produto: "+o),(a=await n())&&a.valid?s[c].push(o+": Processado com sucesso"):(s[c].push(o+": Erro no processo"),console.log(a)),r.is(":visible")?f():void 0}};r.modal({fadeDuration:0,escapeClose:!1,clickClose:!1,closeExisting:!0});try{await f(),p.html("");var v=i('<div class="flex flex-col gap-3"></div>'),m=i('<div class="flex flex-col p-2 rounded bg-neutral-40 max-h-44 overflow-auto mt-2" style="display: none"></div>'),_=i('<a class="mt-1" href="#">Clique para ver</a>'),g=i("<div></div>");if(s.create.length){let e=m.clone();var k=_.clone(),w=g.clone();s.create.forEach(o=>e.append("<div>"+o+"</div>")),k.on("click",function(){e.toggle(200)}),w.append("<div>Concluídos "+s.create.length+" processos de criação de produtos.</div>"),w.append(e,k),v.append(w)}if(s.update.length){let e=m.clone();k=_.clone(),w=g.clone();s.update.forEach(o=>e.append("<div>"+o+"</div>")),k.on("click",function(){e.toggle(200)}),w.append("<div>Concluídos "+s.update.length+" processos de atualização de produtos.</div>"),w.append(e,k),v.append(w)}if(s.stock.length){let e=m.clone();k=_.clone(),w=g.clone();s.stock.forEach(o=>e.append("<div>"+o+"</div>")),k.on("click",function(){e.toggle(200)}),w.append("<div>Concluídos "+s.stock.length+" processos de atualização de stock.</div>"),w.append(e,k),v.append(w)}p.append(v),e.fadeOut(50)}catch(o){e.fadeOut(50),p.fadeOut(50),d.fadeIn(200),console.log(o)}n.hide(),c.show(),o.show(200)};
var Moloni;void 0===(Moloni=void 0===Moloni?{}:Moloni).Logs&&(Moloni.Logs={}),Moloni.Logs=function(i){var e,l={};return{init:function(o){l=o,e=i("#logs-context-modal"),i(".log_button").on("click",function(){var o=i(this).data("logId");if(!isNaN(o)&&0<o){var n=o in l?l[o]:"{}";try{var t=JSON.parse(n);n=JSON.stringify(t||{},null,2)}catch(o){}e.find("#logs-context-modal-content").text(n),e.find("Button").off("click").on("click",function(){var o,t;o=n,(t=document.createElement("a")).setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(o)),t.setAttribute("download","log.txt"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}),e.modal()}})}}}(jQuery);
var Moloni;void 0===(Moloni=void 0===Moloni?{}:Moloni).OrdersBulkAction&&(Moloni.OrdersBulkAction={}),Moloni.OrdersBulkAction=function(){var e=jQuery("#bulk-action-progress-modal"),n=jQuery("#bulk-action-progress-message"),i=jQuery("#bulk-action-progress-current"),o=jQuery("#bulk-action-progress-total"),r=jQuery("#bulk-action-progress-title-start"),t=jQuery("#bulk-action-progress-title-finish"),c=0,l='<br><a class="wp-core-ui button-secondary" style="width: 80px; text-align: center; float:right" href="#" rel="modal:close">Fechar</a>',a=[],s=[],d=[];function u(e,o){o=o||1e3,c++,i.html(c),setTimeout(function(){n.html("A gerar documento da encomenda "+e),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"genInvoice",id:e},success:m,async:!1})},o)}function m(e){n.html(e.message),(e.valid?(jQuery("#moloni-pending-order-row-"+j()).remove(),s):d).push(e),f(),j()?u(j()):setTimeout(p,1e3)}function p(){r.hide(),t.show(),n.html(""),n.append("Documentos emitidos: "+s.length),n.append("<br>Documentos com erros: "+d.length),n.append(l)}function h(e,o){o=o||1e3,c++,i.html(c),setTimeout(function(){n.html("A descartar encomenda "+e),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"discardOrder",id:e},success:g,async:!1})},o)}function g(e){n.html(e.message),(e.valid?(jQuery("#moloni-pending-order-row-"+j()).remove(),s):d).push(e),f(),j()?h(j()):setTimeout(y,1e3)}function y(){r.hide(),t.show(),n.html(""),n.append("Encomendas descartadas: "+s.length),n.append("<br>Encomendas com erros: "+d.length),n.append(l)}function f(){a=a.slice(1)}function j(){return!(!a[0]||!a[0].value)&&a[0].value}function k(){e.modal({fadeDuration:100,escapeClose:!1,clickClose:!1,showClose:!0}),t.hide(),r.show()}function v(){s=[],d=[],c=0}jQuery(".moloni-pending-orders-select-all").click(function(){jQuery('input[id^="moloni-pending-order-"]').not(this).prop("checked",this.checked)}),jQuery('input[id^="moloni-pending-order-"]').click(function(){var n=!0;jQuery('input[id^="moloni-pending-order-"]').each(function(e,o){o.checked||(n=!1)}),jQuery(".moloni-pending-orders-select-all").prop("checked",n)}),jQuery(".tablenav #doAction").click(function(){var e=jQuery("#bulk-action-selector-top").val();"bulkGenInvoice"===e?(k(),v(),(a=jQuery('input[id^="moloni-pending-order-"]:checked'))&&0===a.length?n.html("<div>Não foram selecionadas encomendas"+l+"</div>"):(n.html("A iniciar processo..."),o.html(a.length),u(j()))):"bulkDiscardOrder"===e&&(k(),v(),(a=jQuery('input[id^="moloni-pending-order-"]:checked'))&&0===a.length?n.html("<div>Não foram selecionadas encomendas"+l+"</div>"):(n.html("A iniciar processo..."),o.html(a.length),h(j())))})};
var Moloni;void 0===(Moloni=void 0===Moloni?{}:Moloni).Settings&&(Moloni.Settings={}),Moloni.Settings=function(l){var _;function d(e,n){var t=l("#"+e),a=l("#"+n);t.length&&a.length&&(t.on("change",function(){1===parseInt(t.val())?a.show(200):a.hide(200)}),t.trigger("change"))}return{init:function(e){_=e;var n=l("#document_set_id"),t=l("#document_set_cae_line"),a=l("#document_set_cae_id"),o=l("#document_set_cae_name"),i=l("#document_set_cae_warning");n.length&&t.length&&a.length&&o.length&&i.length&&(n.on("change",function(){var e=l("option[value="+n.val()+"]");a.val(e.attr("data-eac-id")||0),o.val(e.attr("data-eac-name")||"Placeholder"),parseInt(_)!==parseInt(a.val())?i.show(200):i.hide(200),0<parseInt(a.val())?t.show(200):t.hide(200)}),n.trigger("change")),d("invoice_auto","invoice_auto_status_line"),d("document_status","create_bill_of_lading_line"),d("shipping_info","load_address_line"),d("load_address","load_address_custom_line")}}}(jQuery);
var Moloni;void 0===(Moloni=void 0===Moloni?{}:Moloni).MoloniProducts&&(Moloni.MoloniProducts={}),Moloni.MoloniProducts=function(t){return{init:function(){{let c=".checkbox_create_product:enabled:checked, .checkbox_update_stock_product:enabled:checked",o=t(".button-start-imports");t(".checkbox_create_product:enabled, .checkbox_update_stock_product:enabled").off("change").on("change",function(){t(c).length?o.removeAttr("disabled"):o.attr("disabled",!0)}),o.off("click").on("click",function(){let o=[];t(c).each(function(){o.push(t(this))}),o.length&&Moloni.modals.ProductsBulkProcess(o,"toolsCreateWcProduct","toolsUpdateWcStock")})}}}}(jQuery);
var Moloni;void 0===(Moloni=void 0===Moloni?{}:Moloni).WcProducts&&(Moloni.WcProducts={}),Moloni.WcProducts=function(t){return{init:function(){{let c=".checkbox_create_product:enabled:checked, .checkbox_update_stock_product:enabled:checked",o=t(".button-start-exports");t(".checkbox_create_product:enabled, .checkbox_update_stock_product:enabled").off("change").on("change",function(){t(c).length?o.removeAttr("disabled"):o.attr("disabled",!0)}),o.off("click").on("click",function(){let o=[];t(c).each(function(){o.push(t(this))}),o.length&&Moloni.modals.ProductsBulkProcess(o,"toolsCreateMoloniProduct","toolsUpdateMoloniStock")})}}}}(jQuery);
var Moloni;void 0===(Moloni=void 0===Moloni?{}:Moloni).Login&&(Moloni.Login={}),Moloni.Login=function(l){return{init:function(){var o,n,i;o=l("#login_button"),n=l("#username"),i=l("#password"),o.length&&n.length&&i.length&&n.add(i).on("keyup",function(){""===n.val()||""===i.val()?o.prop("disabled",!0):o.removeAttr("disabled")})}}}(jQuery);